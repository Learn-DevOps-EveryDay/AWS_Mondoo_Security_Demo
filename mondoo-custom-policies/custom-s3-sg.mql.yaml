policies:
- name: "Demo Custom AWS Policies"
  uid: demo-aws-security-policy 
  description: "Custom checks for demo project: S3 encryption & SG open SSH"
  platform: aws # Must be lowercase 'aws'
  type: infrastructure # Mandatory type field

  checks:
  - id: demo-s3-encryption
    name: S3 buckets must have default encryption
    impact: 70
    control_domain: data-protection
    # The assert block is the MQL check.
    assert: |
      aws.s3.buckets.where( defaultEncryption.exists == false ).count == 0

  - id: demo-s3-no-public-acl
    name: S3 buckets must not have public ACLs
    impact: 80
    control_domain: access-control
    assert: |
      aws.s3.buckets.none( bucket -> bucket.acl in ["public-read", "public-read-write"] )

  - id: demo-sg-no-ssh-world
    name: Security groups must not allow 0.0.0.0/0 on port 22
    impact: 90
    control_domain: network-security
    assert: |
      aws.security_groups.none( sg -> sg.ingress.any( rule -> rule.from_port == 22 && rule.cidr_blocks.any( c -> c == "0.0.0.0/0" ) ) )